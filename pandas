import pandas as pd
from openpyxl import Workbook
from openpyxl.styles import PatternFill

def highlight_cells(ws, start_row, df):
    highlight_fill = PatternFill(start_color="FFFF00", end_color="FFFF00", fill_type="solid")

    for index, row in df.iterrows():
        for col_idx, value in enumerate(row, start=1):
            cell = ws.cell(row=start_row + index + 1, column=col_idx, value=value)  # Excel rows and columns are 1-indexed
            if pd.notna(value) and value > 50:  # Example condition
                cell.fill = highlight_fill

def process_csv_to_excel(csv_file, chunk_size=100000):
    max_rows_per_excel = 1048576  # Maximum rows per Excel sheet
    chunk_iter = pd.read_csv(csv_file, chunksize=chunk_size)

    file_counter = 1
    current_row = 0
    wb = Workbook()
    ws = wb.active
    ws.title = f'Sheet1_{file_counter}'

    for chunk in chunk_iter:
        if current_row + len(chunk) > max_rows_per_excel:
            # Save the current workbook and start a new one
            excel_file = f'processed_data_{file_counter}.xlsx'
            wb.save(excel_file)
            file_counter += 1

            # Reset the workbook and worksheet
            wb = Workbook()
            ws = wb.active
            ws.title = f'Sheet1_{file_counter}'
            current_row = 0

        highlight_cells(ws, current_row, chunk)
        current_row += len(chunk)

    # Save the last workbook
    excel_file = f'processed_data_{file_counter}.xlsx'
    wb.save(excel_file)

# Example usage
csv_file = 'large_data.csv'
process_csv_to_excel(csv_file)
print('Processing complete.')
